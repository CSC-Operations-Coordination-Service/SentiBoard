{% extends "layouts/base-responsive.html" %}
{% block title %}News{% endblock %}

{% block stylesheets %}
  {{ super() }}
  <style>
    .page-item.active .page-link {
        color: #212529 !important;
        background-color: #ffc107 !important;
        border-color: #ffc107 !important;
    }

    a {
        color: #212529 !important;
    }
    a:focus, a:hover {
        color: #212529 !important;
        text-decoration: none !important;
    }
  </style>
{% endblock %}

{% block content %}
<div class="container" style="margin-top: 120px; margin-bottom: 80px;">
  <!-- Breadcrumb -->
  <div class="page-header">
    <h4 class="page-title">News</h4>
    <ul class="breadcrumbs">
      <li class="nav-home">
        <a href="/index_2.html">
          <i class="flaticon-home"></i>
        </a>
      </li>
      <li class="separator">
        <i class="flaticon-right-arrow"></i>
      </li>
      <li class="nav-item">
        <a href="#">News</a>
      </li>
    </ul>
  </div>

  <div class="row" id="news-card-container">
    <!-- News list will be injected here -->
  </div>

  <!-- Pagination controls -->
  <nav aria-label="News pagination">
    <ul class="pagination justify-content-center mt-4" id="pagination-controls"></ul>
  </nav>
</div>
{% endblock %}

{% block javascripts %}
  {{ super() }}
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $.getJSON("/api/news-images", function(imageList) {
      $.getJSON("/static/assets/json/custom-message.json", function(messages) {
        if (!Array.isArray(messages)) messages = [messages];

        const activeMessages = messages.filter(msg => msg.active);
        const pageSize = 6;
        let currentPage = 1;
        const totalPages = Math.ceil(activeMessages.length / pageSize);

        function getBorderColor(type) {
          switch (type) {
            case 'success': return '#28a745';
            case 'info':    return '#17a2b8';
            case 'warning': return '#ffc107';
            case 'danger':  return '#dc3545';
            default:        return '#006B7C';
          }
        }

        function getIcon(type) {
          switch (type) {
            case 'success': return 'fa-check-circle';
            case 'info':    return 'fa-info-circle';
            case 'warning': return 'fa-exclamation-circle';
            case 'danger':  return 'fa-exclamation-triangle';
            default:        return 'fa-bullhorn';
          }
        }

        function renderNewsPage(page) {
          const start = (page - 1) * pageSize;
          const end = start + pageSize;
          const group = activeMessages.slice(start, end);
          const $container = $('#news-card-container');
          $container.empty();

          group.forEach((msg, i) => {
            const icon = getIcon(msg.type);
            const borderColor = getBorderColor(msg.type);

            const card = `
              <div class="col-12 mb-3">
                <div class="d-flex align-items-center p-3 rounded shadow-sm" style="background-color: #006B7C; color: white;">
                  <div style="font-size: 1.8rem; color: ${borderColor}; margin-right: 2rem;">
                    <i class="fa ${icon}"></i>
                  </div>
                  <div style="font-size: 1.05rem;">
                    ${msg.text}
                    ${msg.link ? `<div class="mt-1"><a href="${msg.link}" class="text-warning" target="_blank" style="text-decoration: underline;">Read more</a></div>` : ''}
                  </div>
                </div>
              </div>
            `;
            $container.append(card);
          });

          renderPaginationControls(page);
        }

        function renderPaginationControls(page) {
          const $pagination = $('#pagination-controls');
          $pagination.empty();

          for (let i = 1; i <= totalPages; i++) {
            $pagination.append(`
              <li class="page-item ${i === page ? 'active' : ''}">
                <a class="page-link" href="#" data-page="${i}">${i}</a>
              </li>
            `);
          }

          $('.page-link').on('click', function(e) {
            e.preventDefault();
            const targetPage = parseInt($(this).data('page'));
            if (targetPage !== currentPage) {
              currentPage = targetPage;
              renderNewsPage(currentPage);
            }
          });
        }

        if (activeMessages.length > 0) {
          renderNewsPage(currentPage);
        } else {
          $('#news-card-container').html('<p class="text-white text-center">No news available.</p>');
        }
      });
    });
  </script>
{% endblock %}
